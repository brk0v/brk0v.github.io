<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  3. getaddrinfo() and POSIX spec
  #


    
        Last updated: Oct 2025
    

Contents

3.1 Resolving hostname (node)
3.2 Resolving ports (services)


Thus, instead of the deprecated gethostbyname(), getaddrinfo() should be used within libc. The getaddrinfo() function is a POSIX-standardized function and is defined in RFC 3943. It is IP version agnostic and returns data structures that can be easily reused in subsequent socket API calls (such as socket(), connect(), sendto()).
First of all, if you have a codebase that uses gethostbyname() and you are looking to migrate to the modern getaddrinfo(), I have bad news: it’s not a drop-in replacement. You need to understand the new data structures, logic and flags."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://biriukov.dev/docs/resolver-dual-stack-application/3-getaddrinfo-and-posix-spec/"><meta property="og:site_name" content="Viacheslav Biriukov"><meta property="og:title" content="getaddrinfo() and POSIX spec"><meta property="og:description" content="3. getaddrinfo() and POSIX spec # Last updated: Oct 2025 Contents
3.1 Resolving hostname (node) 3.2 Resolving ports (services) Thus, instead of the deprecated gethostbyname(), getaddrinfo() should be used within libc. The getaddrinfo() function is a POSIX-standardized function and is defined in RFC 3943. It is IP version agnostic and returns data structures that can be easily reused in subsequent socket API calls (such as socket(), connect(), sendto()).
First of all, if you have a codebase that uses gethostbyname() and you are looking to migrate to the modern getaddrinfo(), I have bad news: it’s not a drop-in replacement. You need to understand the new data structures, logic and flags."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><title>getaddrinfo() and POSIX spec | Viacheslav Biriukov</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png><link rel=stylesheet href=/book.min.1e13c2d8521416f2409b2e0e47b515c4ee90f2718cddd31ea96d2f739bc9d7e1.css integrity="sha256-HhPC2FIUFvJAmy4OR7UVxO6Q8nGM3dMeqW0vc5vJ1+E=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script><script defer src=/en.search.min.fbc32a4965d5fb0c5d6768637844611554b49cbaa2fb2228bcd5552c3d9d78d1.js integrity="sha256-+8MqSWXV+wxdZ2hjeERhFVS0nLqi+yIovNVVLD2deNE=" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-599VSLESJL"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-599VSLESJL")</script><link rel=stylesheet href=/my_css/cookie.css><link rel=stylesheet href=/my_css/copy-code.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Viacheslav Biriukov</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>DNS resolvers and Dual-Stack applications</span><ul><li><a href=/docs/resolver-dual-stack-application/0-sre-should-know-about-gnu-linux-resolvers-and-dual-stack-applications/>Resolvers and Dual-Stack applications for SRE</a></li><li><a href=/docs/resolver-dual-stack-application/1-what-is-a-stub-resolver/>1. What is a stub resolver?</a></li><li><a href=/docs/resolver-dual-stack-application/2-history-gethostbyname/>2. History: gethostbyname()</a></li><li><a href=/docs/resolver-dual-stack-application/3-getaddrinfo-and-posix-spec/ class=active>3. getaddrinfo() and POSIX spec</a></li><li><a href=/docs/resolver-dual-stack-application/4-getaddrinfo-from-glibc/>4. getaddrinfo() from glibc</a></li><li><a href=/docs/resolver-dual-stack-application/5-getaddrinfo-from-musl-libc/>5. getaddrinfo() from musl libc</a></li><li><a href=/docs/resolver-dual-stack-application/6-dual-stack-applications/>6. Dual-Stack applications</a></li><li><a href=/docs/resolver-dual-stack-application/7-async-non-blocking-resolvers-in-c/>7. C async non-blocking resolvers</a></li><li><a href=/docs/resolver-dual-stack-application/8-stub-resolvers-in-languages/>8. Stub resolvers in languages</a></li><li><a href=/docs/resolver-dual-stack-application/9-dual-stack-software-examples/>9. Dual-stack software examples</a></li><li><a href=/docs/resolver-dual-stack-application/10-systemd-resolved/>10. systemd-resolved</a></li><li><a href=/docs/resolver-dual-stack-application/11-querying-nameservers-on-dual-stack-hosts/>11. Querying Nameservers</a></li><li><a href=/docs/resolver-dual-stack-application/12-present-and-future-of-resolvers-and-dns-related-features/>12. Present and future</a></li><li><a href=/docs/resolver-dual-stack-application/troubleshooting-tools-for-resolvers-and-dns/>Troubleshooting tools</a></li></ul></li></ul><div style=margin-top:30px;margin-bottom:30px><b>More recent series:</b><ul><li><a href=/rust-tokio-io/>1. Async Rust & Tokio I/O Streams: Backpressure, Concurrency, and Ergonomics&nbsp;<span style="padding:0 2px;border-radius:2px;background-color:#e84118;color:#f0f8ff">new</span></li><li><a href=/docs/resolver-dual-stack-application/0-sre-should-know-about-gnu-linux-resolvers-and-dual-stack-applications/>2. Resolvers and Dual-Stack applications</li><li><a href=/docs/page-cache/0-linux-page-cache-for-sre/>3. Linux Page Cache mini book</li><li><a href=/docs/fd-pipe-session-terminal/0-sre-should-know-about-gnu-linux-shell-related-internals-file-descriptors-pipes-terminals-user-sessions-process-groups-and-daemons>4. File descriptors, pipes, terminals, user sessions, process groups and daemons</li></ul></div><ul><li><a href=https://twitter.com/brk0v/ target=_blank rel=noopener><i class="bi bi-twitter"></i>
Twitter</a></li><li><a href=https://www.linkedin.com/in/biriukov/ target=_blank rel=noopener><i class="bi bi-linkedin"></i>
Linkedin</a></li><li><a href=https://github.com/brk0v/ target=_blank rel=noopener><i class="bi bi-github"></i>
Github</a></li></ul><div style=margin-top:30px><p xmlns:cc=http://creativecommons.org/ns#>This content is licensed under
<a href="http://creativecommons.org/licenses/by-nc/4.0/?ref=chooser-v1" target=_blank rel="license noopener noreferrer" style=display:inline-block>CC BY-NC 4.0<img style=height:22px!important;margin-left:3px;vertical-align:text-bottom src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img style=height:22px!important;margin-left:3px;vertical-align:text-bottom src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img style=height:22px!important;margin-left:3px;vertical-align:text-bottom src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1"></a></p></div></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>getaddrinfo() and POSIX spec</strong>
<label for=toc-control></label></div></header><article class="markdown book-article"><h1 id=3-getaddrinfo-and-posix-spec>3. <code>getaddrinfo()</code> and POSIX spec
<a class=anchor href=#3-getaddrinfo-and-posix-spec>#</a></h1><p class=updated-right><i><time datetime=2025-10>Last updated: Oct 2025</time></i></p><p><strong>Contents</strong></p><ul><li><a href=/docs/resolver-dual-stack-application/3-getaddrinfo-and-posix-spec/#31-resolving-hostname-node>3.1 Resolving hostname (node)</a></li><li><a href=/docs/resolver-dual-stack-application/3-getaddrinfo-and-posix-spec/#32-resolving-ports-services>3.2 Resolving ports (services)</a></li></ul><hr><p>Thus, instead of the deprecated <code>gethostbyname()</code>, <code>getaddrinfo()</code> should be used within <code>libc</code>. The <code>getaddrinfo()</code> function is a POSIX-<a href=https://pubs.opengroup.org/onlinepubs/9799919799.2024edition/functions/getaddrinfo.html target=_blank rel=noopener>standardized</a> function and is defined in <a href=http://www.ietf.org/rfc/rfc3493.txt target=_blank rel=noopener>RFC 3943</a>. It is IP version agnostic and returns data structures that can be easily reused in subsequent socket API calls (such as <code>socket()</code>, <code>connect()</code>, <code>sendto()</code>).</p><p>First of all, if you have a codebase that uses <code>gethostbyname()</code> and you are looking to migrate to the modern <code>getaddrinfo()</code>, I have bad news: it’s not a drop-in replacement. You need to understand the new data structures, logic and flags.</p><p>Let’s now take a closer look at its parameters and ways to call them, and understand why it is far superior to its predecessor.</p><h2 id=31-resolving-hostname-node>3.1 Resolving hostname (node)
<a class=anchor href=#31-resolving-hostname-node>#</a></h2><p>We begin with a simple, typical example of client code that resolves a hostname into IP addresses:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;string.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/types.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/socket.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;netdb.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;arpa/inet.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>print_ip_addresses</span>(<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>hostname) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>struct</span> addrinfo hints, <span style=color:#f92672>*</span>res, <span style=color:#f92672>*</span>p;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> status;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>char</span> ipstr[INET6_ADDRSTRLEN];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>memset</span>(<span style=color:#f92672>&amp;</span>hints, <span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>sizeof</span> hints);          <span style=color:#75715e>// &lt;--- ①
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    hints.ai_family <span style=color:#f92672>=</span> AF_UNSPEC;              <span style=color:#75715e>// &lt;--- ②
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    hints.ai_socktype <span style=color:#f92672>=</span> SOCK_STREAM;          <span style=color:#75715e>// &lt;--- ③
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ((status <span style=color:#f92672>=</span> <span style=color:#a6e22e>getaddrinfo</span>(hostname, <span style=color:#75715e>/* ---&gt; ④ &lt;--- */</span> NULL, <span style=color:#f92672>&amp;</span>hints, <span style=color:#f92672>&amp;</span>res)) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fprintf</span>(stderr, <span style=color:#e6db74>&#34;getaddrinfo: %s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, <span style=color:#a6e22e>gai_strerror</span>(status));
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;IP addresses for %s:</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>&#34;</span>, hostname);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span>(p <span style=color:#f92672>=</span> res; p <span style=color:#f92672>!=</span> NULL; p <span style=color:#f92672>=</span> p<span style=color:#f92672>-&gt;</span>ai_next) { <span style=color:#75715e>// &lt;--- ⑤
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>addr;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>ipver;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (p<span style=color:#f92672>-&gt;</span>ai_family <span style=color:#f92672>==</span> AF_INET) { <span style=color:#75715e>// IPv4
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>struct</span> sockaddr_in <span style=color:#f92672>*</span>ipv4 <span style=color:#f92672>=</span> (<span style=color:#66d9ef>struct</span> sockaddr_in <span style=color:#f92672>*</span>)p<span style=color:#f92672>-&gt;</span>ai_addr;
</span></span><span style=display:flex><span>            addr <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span>(ipv4<span style=color:#f92672>-&gt;</span>sin_addr);
</span></span><span style=display:flex><span>            ipver <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;IPv4&#34;</span>;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> { <span style=color:#75715e>// IPv6
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>struct</span> sockaddr_in6 <span style=color:#f92672>*</span>ipv6 <span style=color:#f92672>=</span> (<span style=color:#66d9ef>struct</span> sockaddr_in6 <span style=color:#f92672>*</span>)p<span style=color:#f92672>-&gt;</span>ai_addr;
</span></span><span style=display:flex><span>            addr <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span>(ipv6<span style=color:#f92672>-&gt;</span>sin6_addr);
</span></span><span style=display:flex><span>            ipver <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;IPv6&#34;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Convert the IP to a string and print it:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>inet_ntop</span>(p<span style=color:#f92672>-&gt;</span>ai_family, addr, ipstr, <span style=color:#66d9ef>sizeof</span> ipstr);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;  %s: %s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, ipver, ipstr);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>freeaddrinfo</span>(res); <span style=color:#75715e>// free the linked list
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>argv[]) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (argc <span style=color:#f92672>!=</span> <span style=color:#ae81ff>2</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fprintf</span>(stderr, <span style=color:#e6db74>&#34;usage: %s hostname</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, argv[<span style=color:#ae81ff>0</span>]);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>print_ip_addresses</span>(argv[<span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>① – the <code>hints</code> parameter is the primary place to control the behavior of <code>getaddrinfo()</code>. We will be experimenting with it extensively.</p><blockquote class="book-hint info">The <code>memset()</code> function sets all fields to 0, which means none of the members are <code>NULL</code> and, as a result, no default values from <code>getaddrinfo()</code> will be used.</blockquote><p>② – the address family is set to <code>AF_UNSPEC</code>, which means it returns all existing addresses, including both IPv6 and IPv4.</p><p>④ – the <code>service</code> field (essentially the port) is set to <code>NULL</code> because, for a simpler resolver, we are not intending to connect to the remote host.</p><p>③ – here, we set the <code>hints.ai_socktype</code> to <code>SOCK_STREAM</code> because, as I mentioned earlier, the main purpose of <code>getaddrinfo()</code> is to work with socket API functions and prepare data structures for future use. In our case, when we only need IP addresses, the socket type we set here doesn’t really matter. However, we don’t want to set it to <code>NULL</code>. If we did, a <code>getaddrinfo()</code> call would return three times more addresses due to <a href=https://codebrowser.dev/glibc/glibc/nss/getaddrinfo.c.html#gaih_inet_typeproto target=_blank rel=noopener>its internal logic</a>, preparing sockets for <code>TCP</code>, <code>UDP</code>, and <code>RAW</code> connections.</p><p>⑤ – the result of the call is a linked list of <code><a href=https://en.wikipedia.org/wiki/Getaddrinfo target=_blank rel=noopener>addrinfo</a></code> data structures, ready to be used in subsequent socket API calls such as <code>socket</code> (<code><a href=https://man7.org/linux/man-pages/man2/socket.2.html target=_blank rel=noopener>man 2 socket</a></code>), <code>connect</code> (<code><a href=https://man7.org/linux/man-pages/man2/connect.2.html target=_blank rel=noopener>man 2 connect</a></code>), <code>bind</code> (<code><a href=https://man7.org/linux/man-pages/man2/bind.2.html target=_blank rel=noopener>man 2 bind</a></code>), etc.</p><p>Compile it with <code><a href=https://www.gnu.org/software/libc/ target=_blank rel=noopener>glibc</a></code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo apt-get install gcc
</span></span><span style=display:flex><span>$ gcc -o getaddrinfo ./getaddrinfo.c
</span></span></code></pre></div><p>or with <code><a href=https://www.musl-libc.org/ target=_blank rel=noopener>musl libc</a></code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo apt install musl musl-tools
</span></span><span style=display:flex><span>$ musl-gcc -o getaddrinfo ./getaddrinfo.c
</span></span></code></pre></div><p>and run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ./getaddrinfo microsoft.com
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>IP addresses <span style=color:#66d9ef>for</span> microsoft.com:
</span></span><span style=display:flex><span>  IPv4: 20.76.201.171
</span></span><span style=display:flex><span>  IPv4: 20.112.250.133
</span></span><span style=display:flex><span>  IPv4: 20.231.239.246
</span></span><span style=display:flex><span>  IPv4: 20.70.246.20
</span></span><span style=display:flex><span>  IPv4: 20.236.44.162
</span></span><span style=display:flex><span>  IPv6: 2603:1020:201:10::10f
</span></span><span style=display:flex><span>  IPv6: 2603:1030:c02:8::14
</span></span><span style=display:flex><span>  IPv6: 2603:1030:b:3::152
</span></span><span style=display:flex><span>  IPv6: 2603:1030:20e:3::23c
</span></span><span style=display:flex><span>  IPv6: 2603:1010:3:3::5b
</span></span></code></pre></div><blockquote class="book-hint info"><p>Please note that if you have a global scope IPv6 address on your machine, IPv6 addresses will be shown first. This is due to the default behavior described in <a href=https://datatracker.ietf.org/doc/html/rfc6724 target=_blank rel=noopener>RFC 6724</a>, which we will discuss later.</p><p>If you don’t have an IPv6 address but want to experiment with different resolver logic for dual-stack applications, we can work around this by assigning a random global scope IPv6 address to one of the interfaces (not the loopback interface):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo ip a add 2001:db8:123:456:6af2:68fe:ff7c:e25c dev eth0
</span></span></code></pre></div><p>When you want to delete it to rollback to the IPv4 only global scope addresses:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo ip a del 2001:db8:123:456:6af2:68fe:ff7c:e25c dev eth0
</span></span></code></pre></div><p>For the purposes of our experiments with stub resolvers, it’s acceptable that this address will be without proper network routing.</p></blockquote><p>Generally speaking, there are several reasons why <code>getaddrinfo()</code> returns a linked list. According to the documentation from <code><a href=https://man7.org/linux/man-pages/man3/getaddrinfo.3.html target=_blank rel=noopener>man 3 gettaddrinfo</a></code>:</p><blockquote><p>There are several reasons why the linked list may have more than one <code>addrinfo</code> structure, including: the network host is multihomed, accessible over multiple protocols (e.g., both <code>AF_INET</code> and <code>AF_INET6</code>); or the same service is available from multiple socket types (one <code>SOCK_STREAM</code> address and another <code>SOCK_DGRAM</code> address, for example). Normally, the application should try using the addresses in the order in which they are returned. The sorting function used within <code>getaddrinfo()</code> is defined in RFC 3484; the order can be tweaked for a particular system by editing <code>/etc/gai.conf</code> (available since <code>glibc</code> 2.5)</p></blockquote><h2 id=32-resolving-ports-services>3.2 Resolving ports (services)
<a class=anchor href=#32-resolving-ports-services>#</a></h2><p>An interesting aspect of <code>getaddrinfo()</code> is that it also can resolve service names to ports using the <code>/etc/services</code> file. For example, if we change the above example code by:</p><ul><li>adding a &ldquo;<code>domain</code>&rdquo; service (it’s a DNS port 53);</li><li>removing the line ③ with <code>hints.ai_socktype = SOCK_STREAM</code>.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>status <span style=color:#f92672>=</span> <span style=color:#a6e22e>getaddrinfo</span>(hostname, <span style=color:#e6db74>&#34;domain&#34;</span>, <span style=color:#f92672>&amp;</span>hints, <span style=color:#f92672>&amp;</span>res)
</span></span></code></pre></div><p>we will get every IP address twice in the output. The reason is the <code>/etc/services</code> for <code>domain</code> service contains ports for <code>UDP</code> and <code>TCP</code> protocols, hence <code>getaddrinfo()</code> prepares two sockets of each protocol for every address returned from a nameserver:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ grep domain /etc/services
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>domain          53/tcp                          <span style=color:#75715e># Domain Name Server</span>
</span></span><span style=display:flex><span>domain          53/udp
</span></span></code></pre></div><a href=/docs/resolver-dual-stack-application/4-getaddrinfo-from-glibc/ class="book-btn right-button">Read next chapter →</a></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script defer src=/my_js/copy-code.js></script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div></main><div class=cookie-container><p>This website uses "<b>cookies</b>".
Using this website means you're OK with this.
If you are <b>NOT</b>, please close the site page.</p><button class=cookie-btn>
ACCEPT AND CLOSE</button></div><script src=/my_js/cookie.js></script></body></html>