<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  5. getaddrinfo() from musl libc
  #


    
        Last updated: Oct 2025
    

musl libc is a lightweight, fast, and simple implementation of the standard C library (libc) that aims for efficiency, standards compliance, and security.
It gained popularity following its extensive use in Alpine Linux, a security-oriented, lightweight Linux distribution often used as a base image for Docker containers.
However, it is crucial for us to understand that musl libc incorporates a completely new resolver code that behaves differently in certain situations. The most significant differences include:"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://biriukov.dev/docs/resolver-dual-stack-application/5-getaddrinfo-from-musl-libc/"><meta property="og:site_name" content="Viacheslav Biriukov"><meta property="og:title" content="getaddrinfo() from musl libc"><meta property="og:description" content="5. getaddrinfo() from musl libc # Last updated: Oct 2025 musl libc is a lightweight, fast, and simple implementation of the standard C library (libc) that aims for efficiency, standards compliance, and security.
It gained popularity following its extensive use in Alpine Linux, a security-oriented, lightweight Linux distribution often used as a base image for Docker containers.
However, it is crucial for us to understand that musl libc incorporates a completely new resolver code that behaves differently in certain situations. The most significant differences include:"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><title>getaddrinfo() from musl libc | Viacheslav Biriukov</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png><link rel=stylesheet href=/book.min.1e13c2d8521416f2409b2e0e47b515c4ee90f2718cddd31ea96d2f739bc9d7e1.css integrity="sha256-HhPC2FIUFvJAmy4OR7UVxO6Q8nGM3dMeqW0vc5vJ1+E=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script><script defer src=/en.search.min.fbc32a4965d5fb0c5d6768637844611554b49cbaa2fb2228bcd5552c3d9d78d1.js integrity="sha256-+8MqSWXV+wxdZ2hjeERhFVS0nLqi+yIovNVVLD2deNE=" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-599VSLESJL"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-599VSLESJL")</script><link rel=stylesheet href=/my_css/cookie.css><link rel=stylesheet href=/my_css/copy-code.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Viacheslav Biriukov</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>DNS resolvers and Dual-Stack applications</span><ul><li><a href=/docs/resolver-dual-stack-application/0-sre-should-know-about-gnu-linux-resolvers-and-dual-stack-applications/>Resolvers and Dual-Stack applications for SRE</a></li><li><a href=/docs/resolver-dual-stack-application/1-what-is-a-stub-resolver/>1. What is a stub resolver?</a></li><li><a href=/docs/resolver-dual-stack-application/2-history-gethostbyname/>2. History: gethostbyname()</a></li><li><a href=/docs/resolver-dual-stack-application/3-getaddrinfo-and-posix-spec/>3. getaddrinfo() and POSIX spec</a></li><li><a href=/docs/resolver-dual-stack-application/4-getaddrinfo-from-glibc/>4. getaddrinfo() from glibc</a></li><li><a href=/docs/resolver-dual-stack-application/5-getaddrinfo-from-musl-libc/ class=active>5. getaddrinfo() from musl libc</a></li><li><a href=/docs/resolver-dual-stack-application/6-dual-stack-applications/>6. Dual-Stack applications</a></li><li><a href=/docs/resolver-dual-stack-application/7-async-non-blocking-resolvers-in-c/>7. C async non-blocking resolvers</a></li><li><a href=/docs/resolver-dual-stack-application/8-stub-resolvers-in-languages/>8. Stub resolvers in languages</a></li><li><a href=/docs/resolver-dual-stack-application/9-dual-stack-software-examples/>9. Dual-stack software examples</a></li><li><a href=/docs/resolver-dual-stack-application/10-systemd-resolved/>10. systemd-resolved</a></li><li><a href=/docs/resolver-dual-stack-application/11-querying-nameservers-on-dual-stack-hosts/>11. Querying Nameservers</a></li><li><a href=/docs/resolver-dual-stack-application/12-present-and-future-of-resolvers-and-dns-related-features/>12. Present and future</a></li><li><a href=/docs/resolver-dual-stack-application/troubleshooting-tools-for-resolvers-and-dns/>Troubleshooting tools</a></li></ul></li></ul><div style=margin-top:30px;margin-bottom:30px><b>More recent series:</b><ul><li><a href=/rust-tokio-io/>1. Async Rust & Tokio I/O Streams: Backpressure, Concurrency, and Ergonomics&nbsp;<span style="padding:0 2px;border-radius:2px;background-color:#e84118;color:#f0f8ff">new</span></li><li><a href=/docs/resolver-dual-stack-application/0-sre-should-know-about-gnu-linux-resolvers-and-dual-stack-applications/>2. Resolvers and Dual-Stack applications</li><li><a href=/docs/page-cache/0-linux-page-cache-for-sre/>3. Linux Page Cache mini book</li><li><a href=/docs/fd-pipe-session-terminal/0-sre-should-know-about-gnu-linux-shell-related-internals-file-descriptors-pipes-terminals-user-sessions-process-groups-and-daemons>4. File descriptors, pipes, terminals, user sessions, process groups and daemons</li></ul></div><div style=margin-top:30px;margin-bottom:30px><b>Open Source Projects</b><ul><li><a href=https://github.com/brk0v/trixter/tree/main>• trixter chaos proxy</a></li><li><a href=https://crates.io/crates/tokio-netem>• tokio-netem</a></li></ul></div><ul><li><a href=https://twitter.com/brk0v/ target=_blank rel=noopener><i class="bi bi-twitter"></i>
Twitter</a></li><li><a href=https://www.linkedin.com/in/biriukov/ target=_blank rel=noopener><i class="bi bi-linkedin"></i>
Linkedin</a></li><li><a href=https://github.com/brk0v/ target=_blank rel=noopener><i class="bi bi-github"></i>
Github</a></li></ul><div style=margin-top:30px><p xmlns:cc=http://creativecommons.org/ns#>This content is licensed under
<a href="http://creativecommons.org/licenses/by-nc/4.0/?ref=chooser-v1" target=_blank rel="license noopener noreferrer" style=display:inline-block>CC BY-NC 4.0<img style=height:22px!important;margin-left:3px;vertical-align:text-bottom src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img style=height:22px!important;margin-left:3px;vertical-align:text-bottom src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img style=height:22px!important;margin-left:3px;vertical-align:text-bottom src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1"></a></p></div></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>getaddrinfo() from musl libc</strong>
<label for=toc-control></label></div></header><article class="markdown book-article"><h1 id=5-getaddrinfo-from-musl-libc>5. <code>getaddrinfo()</code> from <code>musl</code> <code>libc</code>
<a class=anchor href=#5-getaddrinfo-from-musl-libc>#</a></h1><p class=updated-right><i><time datetime=2025-10>Last updated: Oct 2025</time></i></p><p><code>musl libc</code> is a lightweight, fast, and simple implementation of the standard C library (<code>libc</code>) that aims for efficiency, standards compliance, and security.</p><p>It gained popularity following its extensive use in <a href=https://alpinelinux.org/ target=_blank rel=noopener>Alpine Linux</a>, a security-oriented, lightweight Linux distribution often used as a base image for Docker containers.</p><p>However, it is crucial for us to understand that <code>musl libc</code> incorporates a completely new resolver code that behaves differently in certain <a href=https://wiki.musl-libc.org/functional-differences-from-glibc.html#Name_Resolver_.2F_DNS target=_blank rel=noopener>situations</a>. The most significant differences include:</p><ul><li><p><strong>Instead</strong> of querying nameservers in <code>/etc/resolv.conf</code> <strong>sequentially, one by one,</strong> <code>musl</code> <code>libc</code> queries all of them in parallel and returns the fastest response.</p></li><li><p><code>musl</code> <code>libc</code> does not support the <code>single-request</code> and <code>single-request-reopen</code> in <code>/etc/resolv.conf</code>, which aim to wrap around borked and weirdly behaved network devices.</p></li><li><p>The handling of the <code>domain</code> and <code>search</code> directives may also differ depending on the <code>ndots</code> setting in <code>/etc/resolv.conf</code>.</p><blockquote><p><i>musl&rsquo;s resolver previously did not support the domain and search keywords in <code>resolv.conf</code>. This feature was added in version 1.1.13, but its behavior differs slightly from glibc&rsquo;s: queries with fewer dots than the <code>ndots</code> configuration variable are processed with search first then tried literally (just like <code>glibc</code>), but those with at least as many dots as <code>ndots</code> are only tried in the global namespace (never falling back to search, which <code>glibc</code> would do if the name is not found in the global DNS namespace).</i></p></blockquote></li><li><p>Default <code>ai_flags</code> <a href=https://github.com/libuv/libuv/issues/2225 target=_blank rel=noopener>differences</a> which are important for dual stack applications which we will cover later in the series.</p><p>In <code>glibc</code> (we will cover these flags later in the dual stack section):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>ai_flags <span style=color:#f92672>=</span> AI_ADDRCONFIG<span style=color:#f92672>|</span>AI_V4MAPPED
</span></span></code></pre></div><p>In <code>musl</code> <code>libc</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>ai_flags <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span></code></pre></div></li></ul><p>It is also important to note that TCP support for DNS queries was introduced in <a href=https://www.openwall.com/lists/musl/2023/05/02/1 target=_blank rel=noopener>version 1.2.4</a>. Prior to this, there could be issues handling larger packets, such as those required for DNSSEC or when a <a href=https://martinheinz.dev/blog/92 target=_blank rel=noopener>large number of records are returned</a>—situations that are not unusual in Kubernetes setups.</p><p>Also if we run our example from the Chapter 3 built with <code>musl</code> under <code>strace</code>: we can observe that it doesn&rsquo;t open <code>/etc/nsswitch.conf</code>, the <code>nscd</code> socket, nor <code>/etc/gai.conf</code> (which we discuss later). The only files it reads are:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ strace -e openat ./getaddrinfo microsoft.com
</span></span><span style=display:flex><span>openat<span style=color:#f92672>(</span>AT_FDCWD, <span style=color:#e6db74>&#34;/etc/services&#34;</span>, O_RDONLY|O_LARGEFILE|O_CLOEXEC<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>openat<span style=color:#f92672>(</span>AT_FDCWD, <span style=color:#e6db74>&#34;/etc/hosts&#34;</span>, O_RDONLY|O_LARGEFILE|O_CLOEXEC<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>openat<span style=color:#f92672>(</span>AT_FDCWD, <span style=color:#e6db74>&#34;/etc/resolv.conf&#34;</span>, O_RDONLY|O_LARGEFILE|O_CLOEXEC<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
</span></span></code></pre></div><a href=/docs/resolver-dual-stack-application/6-dual-stack-applications/ class="book-btn right-button">Read next chapter →</a></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script defer src=/my_js/copy-code.js></script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div></main><div class=cookie-container><p>This website uses "<b>cookies</b>".
Using this website means you're OK with this.
If you are <b>NOT</b>, please close the site page.</p><button class=cookie-btn>
ACCEPT AND CLOSE</button></div><script src=/my_js/cookie.js></script></body></html>