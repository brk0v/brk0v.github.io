<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Prepare environment for experiments #  Before I start, I want to be on the same page with the reader, so any example or any code snippet can be executed, compiled and checked. Therefore we need a modern GNU/Linux installation whrer we can play with code and kernel.
If you are using Windows or Mac OS, I would suggest installing Vagrant with Virtual Box. For GNU/Linux distro I&rsquo;d like to use Arch Linux.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="1. Prepare environment" />
<meta property="og:description" content="Prepare environment for experiments #  Before I start, I want to be on the same page with the reader, so any example or any code snippet can be executed, compiled and checked. Therefore we need a modern GNU/Linux installation whrer we can play with code and kernel.
If you are using Windows or Mac OS, I would suggest installing Vagrant with Virtual Box. For GNU/Linux distro I&rsquo;d like to use Arch Linux." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://biriukov.dev/docs/page-cache/1-prepare-environment-for-experiments/" /><meta property="article:section" content="docs" />



<title>1. Prepare environment | Viacheslav Biriukov</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.46181bc93375ba932026e753b37c40e6ff8bb16a9ef770c78bcc663e4577b1ba.css" integrity="sha256-RhgbyTN1upMgJudTs3xA5v&#43;LsWqe93DHi8xmPkV3sbo=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.23e163f906f996fc0fe79b871e3f821b8f290098e043656c181929be0079ed20.js" integrity="sha256-I&#43;Fj&#43;Qb5lvwP55uHHj&#43;CG48pAJjgQ2VsGBkpvgB57SA=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-599VSLESJL"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-599VSLESJL');
</script>

<link rel="stylesheet" href="/my_css/cookie.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>Viacheslav Biriukov</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>Linux Page Cache series</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://biriukov.dev/docs/page-cache/0-linux-page-cache-for-sre/" class="">0. Linux Page Cache for SRE</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://biriukov.dev/docs/page-cache/1-prepare-environment-for-experiments/" class=" active">1. Prepare environment</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://biriukov.dev/docs/page-cache/2-essential-page-cache-theory/" class="">2. Essential theory</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://biriukov.dev/docs/page-cache/3-page-cache-and-basic-file-operations/" class="">3. Basic file operations</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://biriukov.dev/docs/page-cache/4-page-cache-eviction-and-page-reclaim/" class="">4. Eviction and page reclaim</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://biriukov.dev/docs/page-cache/5-more-about-mmap-file-access/" class="">5. More about `mmap()`</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://biriukov.dev/docs/page-cache/6-cgroup-v2-and-page-cache/" class="">6. Cgroup v2</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://biriukov.dev/docs/page-cache/7-how-much-memory-my-program-uses-or-the-tale-of-working-set-size/" class="">7. Unique set and working set</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://biriukov.dev/docs/page-cache/8-direct-io-dio/" class="">8. Direct IO</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://biriukov.dev/docs/page-cache/9-advanced-page-cache-observability-and-troubleshooting-tools/" class="">9. Advanced tools</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>











  
<ul>
  
  <li>
    <a href="https://twitter.com/brk0v/" target="_blank" rel="noopener"><i class="bi bi-twitter"></i>
        Twitter
      </a>
  </li>
  
  <li>
    <a href="https://github.com/brk0v/" target="_blank" rel="noopener"><i class="bi bi-github"></i>
        Github
      </a>
  </li>
  
</ul>





<div style="margin-top: 24px;">
    <p xmlns:cc="http://creativecommons.org/ns#">This content is licensed under <a
            href="http://creativecommons.org/licenses/by-nc/4.0/?ref=chooser-v1" target="_blank"
            rel="license noopener noreferrer" style="display:inline-block; ">CC BY-NC 4.0<img
                style="height:22px!important;margin-left:3px;vertical-align:text-bottom;"
                src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img
                style="height:22px!important;margin-left:3px;vertical-align:text-bottom;"
                src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img
                style="height:22px!important;margin-left:3px;vertical-align:text-bottom;"
                src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1"></a></p>
</div>
</nav>




  <script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>1. Prepare environment</strong>

  <label for="toc-control">
    
  </label>
</div>


  
 
      </header>

      
      
  <article class="markdown"><h1 id="prepare-environment-for-experiments">
  Prepare environment for experiments
  <a class="anchor" href="#prepare-environment-for-experiments">#</a>
</h1>
<p>Before I start, I want to be on the same page with the reader, so any example or any code snippet can be executed, compiled and checked. Therefore we need a modern GNU/Linux installation whrer we can play with code and kernel.</p>
<p>If you are using Windows or Mac OS, I would suggest installing <a href="https://www.vagrantup.com">Vagrant</a> with <a href="https://www.virtualbox.org/">Virtual Box</a>. For GNU/Linux distro I&rsquo;d like to use <a href="https://archlinux.org/">Arch Linux</a>. Arch is a good example of a modern actual version of the GNU/Linux system (<a href="https://i.redd.it/qxsttm8sg5k11.png">BTW, I use Arch Linux</a>). It aslways support the latest kernels, systemd and cgroups v2.</p>
<p>If you&rsquo;re already on Linux you know what to do ðŸ˜‰.</p>
<blockquote class="book-hint info">
  <p><strong>Can I use docker?</strong></p>
<p>Unfortunately, no. We need a system where we can go nuts and play around with cgroup limits, debug programs with low level tools and run code as a root user without any limits.</p>

</blockquote>

<p>So below, I&rsquo;m showing all you need to install on Arch.</p>
<h2 id="arch-linux-provisioning">
  Arch Linux provisioning
  <a class="anchor" href="#arch-linux-provisioning">#</a>
</h2>
<p>When you get your Arch running, please update it and install the following packages:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ pacman -Sy git, base-devel, go
</code></pre></div><p>We need to insall <code>yay</code> (<a href="https://github.com/Jguer/yay">https://github.com/Jguer/yay</a>) in order to be able to setup software from community-driven repositories:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cd ~
$ git clone https://aur.archlinux.org/yay.git
$ cd yay
$ makepkg -si
</code></pre></div><p>Install <code>vmtouch</code> tool from <code>aur</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ yay -Sy vmtouch 
</code></pre></div><p>We will need <code>page-type</code> tool from the kernel repo, so the easiest way to install it, is to download the linux kernel release and make it manually:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ mkdir kernel
$ cd kernel
$ wget https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-5.14.tar.gz
$ tar -xzf linux-5.14.tar.gz
$ cd linux-5.14/tools/vm
$ make
$ sudo make install
</code></pre></div><p>Now we are almost ready. We need to generate a test data file, which will be used in our experiments with Page Cache:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ dd <span style="color:#66d9ef">if</span><span style="color:#f92672">=</span>/dev/random of<span style="color:#f92672">=</span>/var/tmp/file1.db count<span style="color:#f92672">=</span><span style="color:#ae81ff">128</span> bs<span style="color:#f92672">=</span>1M  
</code></pre></div><p>And thhe final step is dropping all linux caches in order to get a clean box:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sync; echo <span style="color:#ae81ff">3</span> | sudo tee /proc/sys/vm/drop_caches
</code></pre></div>



  

<a  href="/docs/page-cache/2-essential-page-cache-theory/"   class="book-btn right-button">
  Read next chapter â†’
</a>

</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  </main>

  
<div class="cookie-container">
    <p>
        This website uses "<b>cookies</b>".
        Using this website means you're OK with this.
        If you are <b>NOT</b>, please close the site page.
    </p>
    <button class="cookie-btn">
        ACCEPT AND CLOSE
    </button>
</div>
<script src="/my_js/cookie.js"></script>
</body>
</html>












